version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
        - |
          node -e "
          const fs = require('fs');
          const config = \`const awsconfig = {
            aws_project_region: process.env.NEXT_PUBLIC_AWS_REGION ?? '',
            aws_appsync_graphqlEndpoint: process.env.NEXT_PUBLIC_APPSYNC_URL ?? '',
            aws_appsync_region: process.env.NEXT_PUBLIC_APPSYNC_REGION ?? process.env.NEXT_PUBLIC_AWS_REGION ?? '',
            aws_appsync_authenticationType: process.env.NEXT_PUBLIC_APPSYNC_AUTH_TYPE ?? 'AMAZON_COGNITO_USER_POOLS',
            aws_appsync_apiKey: process.env.NEXT_PUBLIC_APPSYNC_API_KEY,
            aws_cognito_region: process.env.NEXT_PUBLIC_COGNITO_REGION ?? process.env.NEXT_PUBLIC_AWS_REGION ?? '',
            aws_user_pools_id: process.env.NEXT_PUBLIC_USER_POOL_ID ?? '',
            aws_user_pools_web_client_id: process.env.NEXT_PUBLIC_USER_POOL_CLIENT_ID ?? '',
            aws_cognito_username_attributes: ['EMAIL'],
            aws_cognito_social_providers: [],
            aws_cognito_signup_attributes: ['EMAIL'],
            aws_cognito_mfa_configuration: 'OFF',
            aws_cognito_mfa_types: [],
            aws_cognito_password_protection_settings: {
              passwordPolicyMinLength: 8,
              passwordPolicyCharacters: []
            },
            oauth: {}
          };
          export default awsconfig;
          \`;
          fs.writeFileSync('aws-exports.js', config);
          "
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
